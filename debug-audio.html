<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Debug - Quran Reader</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: #f0f0f0;
        }
        .test-box {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 2px solid #ddd;
        }
        button {
            padding: 15px 25px;
            margin: 10px;
            border: none;
            border-radius: 5px;
            background: #4CAF50;
            color: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .status {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #2196F3;
        }
        .error {
            background: #ffebee;
            border-left-color: #f44336;
        }
        .success {
            background: #e8f5e8;
            border-left-color: #4CAF50;
        }
        .volume-control {
            margin: 20px 0;
        }
        input[type="range"] {
            width: 100%;
            margin: 10px 0;
        }
        .arabic {
            font-size: 24px;
            direction: rtl;
            text-align: center;
            margin: 15px 0;
            color: #2c5282;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ Audio Debug Tool</h1>
    <p>Let's figure out why you can't hear the audio and fix it step by step.</p>

    <div class="test-box">
        <h2>ğŸ”Š Step 1: Basic System Volume Test</h2>
        <p>First, let's test if your system can make ANY sound at all:</p>
        <button onclick="testSystemBeep()">ğŸ”” Test System Beep</button>
        <div class="volume-control">
            <label>ğŸ”Š Master Volume: <span id="volumeDisplay">50%</span></label>
            <input type="range" id="masterVolume" min="0" max="100" value="50" oninput="updateVolume()">
        </div>
        <div class="status" id="systemStatus">Click the button above to test system audio</div>
    </div>

    <div class="test-box">
        <h2>ğŸ™ï¸ Step 2: Text-to-Speech Test</h2>
        <p>Now let's test Text-to-Speech with simple English first:</p>
        <button onclick="testEnglishTTS()">ğŸ—£ï¸ Say "Hello World" (English)</button>
        <button onclick="testArabicTTS()">ğŸ•Œ Say "Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…" (Arabic)</button>
        <div class="status" id="ttsStatus">Click buttons above to test TTS</div>
    </div>

    <div class="test-box">
        <h2>ğŸ“– Step 3: Quran Words Test</h2>
        <div class="arabic">Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</div>
        <button onclick="testQuranWord('Ø¨ÙØ³Ù’Ù…Ù')">ğŸµ Say "Ø¨ÙØ³Ù’Ù…Ù"</button>
        <button onclick="testQuranWord('Ø§Ù„Ù„ÙÙ‘Ù‡Ù')">ğŸµ Say "Ø§Ù„Ù„ÙÙ‘Ù‡Ù"</button>
        <button onclick="testQuranWord('Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù')">ğŸµ Say "Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ†Ù"</button>
        <div class="status" id="quranStatus">Click buttons above to test Quran pronunciation</div>
    </div>

    <div class="test-box">
        <h2>ğŸ” Step 4: System Information</h2>
        <button onclick="checkFullSystem()">ğŸ” Check Everything</button>
        <div id="systemInfo">
            <p><strong>Browser:</strong> <span id="browserInfo">Checking...</span></p>
            <p><strong>TTS Support:</strong> <span id="ttsSupport">Checking...</span></p>
            <p><strong>Audio Context:</strong> <span id="audioContext">Checking...</span></p>
            <p><strong>Available Voices:</strong> <span id="voicesList">Checking...</span></p>
            <p><strong>Arabic Voices:</strong> <span id="arabicVoicesList">Checking...</span></p>
        </div>
    </div>

    <div class="test-box">
        <h2>ğŸ› ï¸ Quick Fixes</h2>
        <div id="suggestions">
            <h3>Try these if audio doesn't work:</h3>
            <ol>
                <li><strong>Check System Volume:</strong> Make sure your computer/phone volume is up</li>
                <li><strong>Check Browser Volume:</strong> Some browsers have individual tab volume controls</li>
                <li><strong>Try Headphones:</strong> Sometimes speakers are muted but headphones work</li>
                <li><strong>Enable Audio:</strong> Click anywhere on the page first (browsers require user interaction)</li>
                <li><strong>Try Different Browser:</strong> Chrome and Edge usually work best</li>
                <li><strong>Check Browser Settings:</strong> Make sure audio/sound is allowed for websites</li>
            </ol>
        </div>
    </div>

    <script>
        let masterVolumeLevel = 0.5;
        let audioContext = null;

        function updateVolume() {
            const volume = document.getElementById('masterVolume').value;
            masterVolumeLevel = volume / 100;
            document.getElementById('volumeDisplay').textContent = volume + '%';
            console.log('Volume set to:', masterVolumeLevel);
        }

        function updateStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = 'status';
            if (type === 'error') element.classList.add('error');
            if (type === 'success') element.classList.add('success');
        }

        async function testSystemBeep() {
            updateStatus('systemStatus', 'ğŸ”Š Testing system beep...', 'info');
            
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }

                if (audioContext.state === 'suspended') {
                    await audioContext.resume();
                    console.log('Audio context resumed');
                }

                // Create a clear, loud beep
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.value = 800; // Higher frequency is easier to hear
                oscillator.type = 'sine';

                // Set volume based on slider
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(masterVolumeLevel * 0.3, audioContext.currentTime + 0.1);
                gainNode.gain.linearRampToValueAtTime(masterVolumeLevel * 0.1, audioContext.currentTime + 0.5);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 1);

                oscillator.start();
                oscillator.stop(audioContext.currentTime + 1);

                updateStatus('systemStatus', 'ğŸ”Š Playing beep... Do you hear it?', 'info');

                oscillator.onended = () => {
                    updateStatus('systemStatus', 'âœ… Beep finished. Did you hear it? If not, check your volume/speakers.', 'success');
                };

            } catch (error) {
                console.error('Beep error:', error);
                updateStatus('systemStatus', `âŒ Beep failed: ${error.message}`, 'error');
            }
        }

        async function testEnglishTTS() {
            updateStatus('ttsStatus', 'ğŸ—£ï¸ Testing English TTS...', 'info');

            if (!('speechSynthesis' in window)) {
                updateStatus('ttsStatus', 'âŒ Text-to-Speech not supported in this browser', 'error');
                return;
            }

            try {
                // Cancel any existing speech
                speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance('Hello World. This is a test.');
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                utterance.pitch = 1.0;
                utterance.volume = masterVolumeLevel;

                utterance.onstart = () => {
                    updateStatus('ttsStatus', 'ğŸ—£ï¸ Speaking English... Do you hear it?', 'info');
                };

                utterance.onend = () => {
                    updateStatus('ttsStatus', 'âœ… English TTS finished. Did you hear "Hello World"?', 'success');
                };

                utterance.onerror = (error) => {
                    updateStatus('ttsStatus', `âŒ English TTS failed: ${error.error}`, 'error');
                };

                speechSynthesis.speak(utterance);

            } catch (error) {
                console.error('English TTS error:', error);
                updateStatus('ttsStatus', `âŒ English TTS error: ${error.message}`, 'error');
            }
        }

        async function testArabicTTS() {
            updateStatus('ttsStatus', 'ğŸ•Œ Testing Arabic TTS...', 'info');

            if (!('speechSynthesis' in window)) {
                updateStatus('ttsStatus', 'âŒ Text-to-Speech not supported in this browser', 'error');
                return;
            }

            try {
                speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance('Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…');
                utterance.lang = 'ar-SA';
                utterance.rate = 0.6;
                utterance.pitch = 1.0;
                utterance.volume = masterVolumeLevel;

                // Try to find Arabic voice
                const voices = speechSynthesis.getVoices();
                const arabicVoice = voices.find(voice => 
                    voice.lang.includes('ar') || voice.name.toLowerCase().includes('arabic')
                );

                if (arabicVoice) {
                    utterance.voice = arabicVoice;
                    console.log('Using Arabic voice:', arabicVoice.name);
                } else {
                    console.log('No Arabic voice found, using default');
                }

                utterance.onstart = () => {
                    updateStatus('ttsStatus', 'ğŸ•Œ Speaking Arabic... Do you hear it?', 'info');
                };

                utterance.onend = () => {
                    updateStatus('ttsStatus', 'âœ… Arabic TTS finished. Did you hear Arabic?', 'success');
                };

                utterance.onerror = (error) => {
                    updateStatus('ttsStatus', `âŒ Arabic TTS failed: ${error.error}`, 'error');
                };

                speechSynthesis.speak(utterance);

            } catch (error) {
                console.error('Arabic TTS error:', error);
                updateStatus('ttsStatus', `âŒ Arabic TTS error: ${error.message}`, 'error');
            }
        }

        async function testQuranWord(word) {
            updateStatus('quranStatus', `ğŸµ Testing Quran word: ${word}...`, 'info');

            if (!('speechSynthesis' in window)) {
                updateStatus('quranStatus', 'âŒ Text-to-Speech not supported', 'error');
                return;
            }

            try {
                speechSynthesis.cancel();

                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'ar-SA';
                utterance.rate = 0.5; // Slow for clarity
                utterance.pitch = 1.0;
                utterance.volume = masterVolumeLevel;

                utterance.onstart = () => {
                    updateStatus('quranStatus', `ğŸµ Speaking "${word}"... Listen carefully!`, 'info');
                };

                utterance.onend = () => {
                    updateStatus('quranStatus', `âœ… Finished "${word}". Did you hear the Arabic pronunciation?`, 'success');
                };

                utterance.onerror = (error) => {
                    updateStatus('quranStatus', `âŒ Failed to speak "${word}": ${error.error}`, 'error');
                };

                speechSynthesis.speak(utterance);

            } catch (error) {
                console.error('Quran word error:', error);
                updateStatus('quranStatus', `âŒ Error speaking "${word}": ${error.message}`, 'error');
            }
        }

        function checkFullSystem() {
            // Browser info
            document.getElementById('browserInfo').textContent = navigator.userAgent.includes('Chrome') ? 'Chrome âœ…' : 
                navigator.userAgent.includes('Firefox') ? 'Firefox âš ï¸' : 
                navigator.userAgent.includes('Safari') ? 'Safari âš ï¸' : 'Other Browser â“';

            // TTS Support
            if ('speechSynthesis' in window) {
                document.getElementById('ttsSupport').textContent = 'âœ… Supported';
                document.getElementById('ttsSupport').style.color = 'green';
            } else {
                document.getElementById('ttsSupport').textContent = 'âŒ Not Supported';
                document.getElementById('ttsSupport').style.color = 'red';
            }

            // Audio Context
            try {
                const testContext = new (window.AudioContext || window.webkitAudioContext)();
                document.getElementById('audioContext').textContent = `âœ… Available (${testContext.state})`;
                document.getElementById('audioContext').style.color = 'green';
            } catch (error) {
                document.getElementById('audioContext').textContent = 'âŒ Not Available';
                document.getElementById('audioContext').style.color = 'red';
            }

            // Voices
            const voices = speechSynthesis.getVoices();
            document.getElementById('voicesList').textContent = `${voices.length} voices found`;
            
            const arabicVoices = voices.filter(v => v.lang.includes('ar'));
            if (arabicVoices.length > 0) {
                document.getElementById('arabicVoicesList').textContent = 
                    `âœ… ${arabicVoices.length} Arabic voices: ${arabicVoices.map(v => v.name).slice(0, 3).join(', ')}`;
                document.getElementById('arabicVoicesList').style.color = 'green';
            } else {
                document.getElementById('arabicVoicesList').textContent = 'âš ï¸ No Arabic voices found';
                document.getElementById('arabicVoicesList').style.color = 'orange';
            }
        }

        // Auto-check system on page load
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(checkFullSystem, 500);
            
            // Load voices if not already loaded
            if (speechSynthesis.getVoices().length === 0) {
                speechSynthesis.onvoiceschanged = () => {
                    checkFullSystem();
                };
            }
        });

        // Enable audio context on first user interaction
        document.addEventListener('click', async () => {
            if (audioContext && audioContext.state === 'suspended') {
                try {
                    await audioContext.resume();
                    console.log('Audio context activated by user interaction');
                } catch (error) {
                    console.error('Failed to resume audio context:', error);
                }
            }
        }, { once: true });
    </script>
</body>
</html>