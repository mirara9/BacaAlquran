<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Quran Reader</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .debug-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 2px solid #ddd;
        }
        .error { color: red; font-weight: bold; }
        .success { color: green; font-weight: bold; }
        .warning { color: orange; font-weight: bold; }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            background: #4CAF50;
            color: white;
            cursor: pointer;
        }
        button:hover { background: #45a049; }
        #debugOutput {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <h1>ðŸ”§ Quran Reader Debug Tool</h1>
    
    <div class="debug-section">
        <h2>1. DOM Elements Check</h2>
        <button onclick="checkDOMElements()">Check All Elements</button>
        <div id="domCheck"></div>
    </div>
    
    <div class="debug-section">
        <h2>2. Browser Compatibility</h2>
        <button onclick="checkBrowserSupport()">Check Browser Features</button>
        <div id="browserCheck"></div>
    </div>
    
    <div class="debug-section">
        <h2>3. QuranReader Class Test</h2>
        <button onclick="testQuranReaderClass()">Test Class Initialization</button>
        <div id="classTest"></div>
    </div>
    
    <div class="debug-section">
        <h2>4. Event Binding Test</h2>
        <button onclick="testEventBinding()">Test Button Events</button>
        <div id="eventTest"></div>
    </div>
    
    <div class="debug-section">
        <h2>5. Debug Output</h2>
        <button onclick="clearDebug()">Clear Output</button>
        <div id="debugOutput"></div>
    </div>

    <!-- Hidden elements for testing -->
    <div style="display: none;">
        <button id="startBtn">Start Reading</button>
        <button id="stopBtn">Stop Reading</button>
        <button id="nextPageBtn">Next Page</button>
        <button id="prevPageBtn">Previous Page</button>
        <button id="tajweedToggle">Enable Tajweed</button>
        <select id="qariSelector">
            <option value="abdul_basit">Abdul Basit</option>
        </select>
        <div id="quranText"></div>
        <div id="listeningStatus"></div>
        <div id="progressFill"></div>
        <div id="currentPage"></div>
        <div id="totalPages"></div>
        <div id="tajweedFeedback"></div>
        <div id="tajweedContent"></div>
        <div id="audioStatus"></div>
        <div id="audioStatusIcon"></div>
        <div id="audioStatusText"></div>
    </div>

    <script>
        // Override console.log to show output in the debug div
        const originalLog = console.log;
        const originalError = console.error;
        const debugOutput = document.getElementById('debugOutput');
        
        function addToDebug(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? 'red' : type === 'warn' ? 'orange' : 'black';
            debugOutput.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span>\n`;
            debugOutput.scrollTop = debugOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToDebug(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToDebug('ERROR: ' + args.join(' '), 'error');
        };
        
        function checkDOMElements() {
            const elements = [
                'startBtn', 'stopBtn', 'nextPageBtn', 'prevPageBtn', 
                'tajweedToggle', 'qariSelector', 'quranText', 
                'listeningStatus', 'progressFill', 'currentPage', 
                'totalPages', 'tajweedFeedback', 'tajweedContent',
                'audioStatus', 'audioStatusIcon', 'audioStatusText'
            ];
            
            const results = elements.map(id => {
                const element = document.getElementById(id);
                return {
                    id: id,
                    found: !!element,
                    type: element ? element.tagName.toLowerCase() : 'not found'
                };
            });
            
            let html = '<h3>DOM Elements Status:</h3>';
            results.forEach(result => {
                const status = result.found ? 
                    `<span class="success">âœ“ Found (${result.type})</span>` : 
                    `<span class="error">âœ— Missing</span>`;
                html += `<div><strong>${result.id}:</strong> ${status}</div>`;
            });
            
            document.getElementById('domCheck').innerHTML = html;
            console.log('DOM check completed:', results);
        }
        
        function checkBrowserSupport() {
            const features = {
                'Speech Recognition': ('webkitSpeechRecognition' in window) || ('SpeechRecognition' in window),
                'Speech Synthesis': 'speechSynthesis' in window,
                'Web Audio API': 'AudioContext' in window || 'webkitAudioContext' in window,
                'Local Storage': 'localStorage' in window,
                'Fetch API': 'fetch' in window
            };
            
            let html = '<h3>Browser Feature Support:</h3>';
            Object.entries(features).forEach(([feature, supported]) => {
                const status = supported ? 
                    `<span class="success">âœ“ Supported</span>` : 
                    `<span class="error">âœ— Not Supported</span>`;
                html += `<div><strong>${feature}:</strong> ${status}</div>`;
            });
            
            // Additional info
            html += `<div><strong>User Agent:</strong> ${navigator.userAgent}</div>`;
            
            document.getElementById('browserCheck').innerHTML = html;
            console.log('Browser support check completed:', features);
        }
        
        function testQuranReaderClass() {
            console.log('Testing QuranReader class initialization...');
            
            try {
                // Load the original script
                const script = document.createElement('script');
                script.src = 'script.js';
                script.onload = function() {
                    console.log('script.js loaded successfully');
                    
                    try {
                        // Try to create an instance
                        const testReader = new QuranReader();
                        console.log('QuranReader instance created successfully');
                        
                        document.getElementById('classTest').innerHTML = 
                            '<span class="success">âœ“ QuranReader class loaded and instantiated successfully</span>';
                    } catch (error) {
                        console.error('Error creating QuranReader instance:', error);
                        document.getElementById('classTest').innerHTML = 
                            `<span class="error">âœ— Error creating instance: ${error.message}</span>`;
                    }
                };
                script.onerror = function() {
                    console.error('Failed to load script.js');
                    document.getElementById('classTest').innerHTML = 
                        '<span class="error">âœ— Failed to load script.js</span>';
                };
                
                document.head.appendChild(script);
                
            } catch (error) {
                console.error('Error in testQuranReaderClass:', error);
                document.getElementById('classTest').innerHTML = 
                    `<span class="error">âœ— Test failed: ${error.message}</span>`;
            }
        }
        
        function testEventBinding() {
            console.log('Testing event binding...');
            
            const testButton = document.getElementById('startBtn');
            if (testButton) {
                // Add test event listener
                testButton.addEventListener('click', function() {
                    console.log('Test button clicked successfully!');
                    document.getElementById('eventTest').innerHTML = 
                        '<span class="success">âœ“ Event binding works - button responded to click</span>';
                });
                
                // Programmatically click it
                testButton.click();
            } else {
                document.getElementById('eventTest').innerHTML = 
                    '<span class="error">âœ— Test button not found</span>';
            }
        }
        
        function clearDebug() {
            debugOutput.innerHTML = '';
        }
        
        // Auto-run basic checks
        window.addEventListener('load', () => {
            console.log('Debug page loaded, running automatic checks...');
            checkDOMElements();
            checkBrowserSupport();
        });
    </script>
</body>
</html>